from SVI_NelderMeadOptimization import *
import matplotlib.pyplot as plt

#data for optimization:
#data = [log_fmoneyness, totalvariance, volatility, ttm, strikes, Ft]
data =  [[-0.6883926712032412, -0.6681899638857219, -0.6483873365895422, -0.6289692507324406, -0.6099210557617462, -0.5912289227495936, -0.572879784081397, -0.5548612785787188, -0.5371617014793179, -0.5197699587674486, -0.5026755254081484, -0.4858684070917673, -0.4693391051405567, -0.45307858426877634, -0.4370782429223353, -0.42132988595419607, -0.40582569941823077, -0.39055822728744244, -0.3755203499229019, -0.3607052641377612, -0.3461064647166086, -0.331717727264509, -0.3175330922725525, -0.3035468502978127, -0.28975352816547684, -0.27614787610969815, -0.26272485577755744, -0.2494796290275369, -0.23640754746018408, -0.22350414262427615, -0.21076511684684648, -0.19818633463998633, -0.1931987931289473, -0.18576381464142913, -0.18329772214623566, -0.17349372204961488, -0.16137236151727002, -0.1493961704705543, -0.13756171282355154, -0.12586567306036023, -0.11430485065928421, -0.10287615483566154, -0.09157659958172813, -0.08040329898360286, -0.06935346279701797, -0.058424392264827665, -0.047613476160612005, -0.03691818704386401, -0.026336077713327147, -0.01586477784603171, -0.00963422809539568, -0.0055019908104850905, 0.0006645241051789548, 0.004754509356704041, 0.012884635439954191, 0.014906880820721863, 0.02094919527668455, 0.02495721667422334, 0.034907547527391454, 0.04475984397040312, 0.05451601891576784, 0.06417792982750477, 0.07374738084365551, 0.0832261247981991, 0.09261586514803817, 0.10191825781035171, 0.11113491291527576, 0.12026739647854831, 0.12931723199846626, 0.1382859019812265, 0.17337722179249673, 0.207278773468178, 0.24006859629116897], [0.04076668649331052, 0.03877129572538979, 0.04552171556560482, 0.04304954021722698, 0.042956122312415135, 0.0423525418447454, 0.041412113179385444, 0.04026581379477327, 0.03897774098175873, 0.03844802081158727, 0.03690091342019062, 0.035334380648986176, 0.034322970726551605, 0.033180470671619416, 0.04329798529413132, 0.04098259902858427, 0.038733672912626776, 0.03998073362065533, 0.027360960657585195, 0.02591244412754271, 0.018611062340455935, 0.023784682274204688, 0.022800244623565613, 0.021746622730069932, 0.02077364007799664, 0.01974252546926645, 0.02003303018633617, 0.017999129970047503, 0.01706863881061563, 0.016656303454288035, 0.01575065055516378, 0.014941695008553265, 0.014564385706036841, 0.014069303489073632, 0.013872871571435833, 0.01322198665486113, 0.012456133893823398, 0.011687890904314572, 0.010935490838574563, 0.01023007703993914, 0.009534966661326336, 0.008732692271871251, 0.008104654787660396, 0.0073913102350302825, 0.006860739537631138, 0.006280424070654008, 0.005723018542276139, 0.005159713701823083, 0.004606645935247041, 0.004131089933770495, 0.0038402451626455714, 0.003642071986260716, 0.0033776996195825555, 0.003209518468884481, 0.002885147498456492, 0.002815602967398704, 0.002601932836694457, 0.002462741874048825, 0.00216985123156248, 0.001940347902664068, 0.0018134979727892477, 0.001790422493315378, 0.0018403146718379499, 0.0020482470516224767, 0.0022633646635596277, 0.002461510439193153, 0.0027391092687757716, 0.0029248948072492192, 0.003251424275149249, 0.0034692129871842603, 0.0045001614592469485, 0.006404225215396508, 0.007892686226211011], [0.369475708007813, 0.36031997680664096, 0.39042938232421903, 0.379679756164551, 0.379267578125, 0.376593589782715, 0.372389030456543, 0.36719894409179704, 0.36127799987792997, 0.358814659118652, 0.351521377563477, 0.34397899627685496, 0.339020233154297, 0.333330039978027, 0.38077377319335903, 0.370452842712402, 0.360145111083984, 0.36589675903320296, 0.302690544128418, 0.294569225311279, 0.249642639160156, 0.28221614837646497, 0.276314029693604, 0.269854145050049, 0.263748188018799, 0.257119216918945, 0.259004020690918, 0.245504207611084, 0.239074153900146, 0.236168785095215, 0.229658451080322, 0.223683071136475, 0.22084077835083002, 0.217054843902588, 0.215534286499023, 0.210417346954346, 0.204232482910156, 0.197834148406982, 0.19136051177978503, 0.18508560180664102, 0.178686923980713, 0.171004390716553, 0.164740524291992, 0.157323608398438, 0.151571884155273, 0.14501992225646998, 0.138434953689575, 0.131445579528809, 0.124201145172119, 0.117615756988525, 0.113399896621704, 0.11043518066406299, 0.106351518630981, 0.10367000579834, 0.0982917785644531, 0.0970999240875244, 0.0933428859710693, 0.0908118724822998, 0.0852409267425537, 0.08060704231262211, 0.07792767524719241, 0.0774303007125854, 0.07850172996521, 0.0828179264068604, 0.0870583534240723, 0.09078916549682621, 0.0957718467712402, 0.09896652221679689, 0.10434460639953601, 0.107782602310181, 0.122757272720337, 0.146442279815674, 0.16257194519043], 0.29863013698630136, [1000.0, 1100.0, 1200.0, 1225.0, 1250.0, 1275.0, 1300.0, 1325.0, 1350.0, 1375.0, 1400.0, 1425.0, 1450.0, 1475.0, 1500.0, 1525.0, 1550.0, 1575.0, 1600.0, 1625.0, 1650.0, 1675.0, 1700.0, 1725.0, 1750.0, 1775.0, 1800.0, 1825.0, 1850.0, 1875.0, 1900.0, 1925.0, 1950.0, 1975.0, 2000.0, 2010.0, 2025.0, 2030.0, 2050.0, 2075.0, 2100.0, 2125.0, 2150.0, 2175.0, 2200.0, 2225.0, 2250.0, 2275.0, 2300.0, 2325.0, 2350.0, 2375.0, 2400.0, 2415.0, 2425.0, 2440.0, 2450.0, 2470.0, 2475.0, 2490.0, 2500.0, 2525.0, 2550.0, 2575.0, 2600.0, 2625.0, 2650.0, 2675.0, 2700.0, 2725.0, 2750.0, 2775.0, 2800.0, 2900.0, 3000.0, 3100.0], 2438.379099806637]
init_adc = [1,1,1]
nm = SVI_NelderMeadOptimization(data, init_adc)
_a_star, _d_star, _c_star, m_star, sigma_star = nm.optimization()
log_fmoneyness = data[0]
totalvariance  = data[1]
volatility     = data[2]

x_svi  = np.arange(min(log_fmoneyness), max(log_fmoneyness), 0.1 / 100) # log_forward_moneyness
y_svi  = np.divide((x_svi - m_star),sigma_star)
tv_svi = _a_star + _d_star*y_svi + _c_star* np.sqrt(y_svi**2 + 1) # totalvariance objective fution values
########################################################################################################################
# plot input data -- moneyness-imliedvol
plt.figure(2)
plt.plot(log_fmoneyness, totalvariance, 'ro')
# Plot SVI volatility smile -- moneyness-impliedVol
plt.plot(x_svi, tv_svi, 'b--')
plt.title('SVI total variance')
plt.show()